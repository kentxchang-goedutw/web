<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Markdown 簡報產生器</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/showdown/dist/showdown.min.js"></script>
<style>
body {
    background: linear-gradient(135deg, #74ebd5 0%, #acb6e5 100%);
    font-family: 'Noto Sans TC', sans-serif;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #333;
}

h1 {
    margin-top: 20px;
    color: #fff;
}

textarea {
    width: 80%;
    height: 180px;
    padding: 15px;
    border-radius: 10px;
    border: none;
    box-shadow: 0 4px 15px rgba(0,0,0,.2);
    resize: vertical;
}

.controls {
    margin-top: 10px;
}

button {
    padding: 10px 20px;
    margin-right: 10px;
    border: none;
    border-radius: 5px;
    background-color: #ff6b81;
    color: #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,.2);
    cursor: pointer;
}

#slides {
    position: relative;
    width: 100%;
    flex-grow: 1;
    overflow: hidden;
}

.slide {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: none;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 20px;
    box-sizing: border-box;
}

.slide-content {
    width: 90%;
    margin: auto;
}

.slide.active {
    display: flex;
}
</style>
</head>
<body>
<h1>Markdown 簡報產生器</h1>
<textarea id="markdown" placeholder="每頁以 --- 分隔的 Markdown"></textarea>
<div class="controls">
    <button id="renderBtn">轉換</button>
    <button id="downloadBtn">下載 HTML</button>
    <button id="fullscreenBtn">全螢幕</button>
</div>
<div id="slides"></div>
<script>
const converter = new showdown.Converter();
let slides = [];
let current = 0;

function autoFitText(slide){
    const content = slide.querySelector('.slide-content');
    if(!content) return;
    let size = 8;
    content.style.fontSize = size + 'vw';
    while(content.scrollHeight > window.innerHeight * 0.9 && size > 1){
        size -= 0.5;
        content.style.fontSize = size + 'vw';
    }
}

function showSlide(index){
    if(!slides.length) return;
    slides.forEach((s,i)=>s.classList.toggle('active', i===index));
    current = index;
}

function renderSlides(){
    const md = document.getElementById('markdown').value;
    const sections = md.split(/^---$/m).map(s=>s.trim()).filter(Boolean);
    const container = document.getElementById('slides');
    container.innerHTML = '';
    slides = sections.map(sec => {
        const html = converter.makeHtml(sec);
        const div = document.createElement('div');
        div.className = 'slide';
        div.innerHTML = `<div class="slide-content">${html}</div>`;
        container.appendChild(div);
        autoFitText(div);
        return div;
    });
    showSlide(0);
}

document.getElementById('renderBtn').addEventListener('click', renderSlides);

document.getElementById('downloadBtn').addEventListener('click', ()=>{
    const slidesHTML = document.getElementById('slides').innerHTML;
    const styles = document.querySelector('style').innerHTML;
    const download = `<!DOCTYPE html><html lang="zh-Hant"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Markdown 簡報</title><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet"><style>${styles}</style></head><body><div id="slides">${slidesHTML}</div><script>(function(){var slides=[].slice.call(document.querySelectorAll('.slide'));var i=0;function fit(){slides.forEach(function(sl){var c=sl.firstElementChild;var size=8;c.style.fontSize=size+'vw';while(c.scrollHeight>window.innerHeight*0.9&&size>1){size-=0.5;c.style.fontSize=size+'vw';}});}function show(n){slides.forEach(function(s,idx){s.style.display=idx===n?'flex':'none';});i=n;}window.addEventListener('keydown',function(e){if(e.key==='ArrowRight'){show((i+1)%slides.length);}else if(e.key==='ArrowLeft'){show((i-1+slides.length)%slides.length);}});window.addEventListener('resize',fit);fit();show(0);})();</script></body></html>`;
    const blob = new Blob([download], {type: 'text/html'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'presentation.html';
    a.click();
    URL.revokeObjectURL(a.href);
});

document.getElementById('fullscreenBtn').addEventListener('click', ()=>{
    if(!document.fullscreenElement){
        document.documentElement.requestFullscreen();
    }else{
        document.exitFullscreen();
    }
});

window.addEventListener('keydown', e=>{
    if(!slides.length) return;
    if(e.key === 'ArrowRight'){
        showSlide((current + 1) % slides.length);
    } else if(e.key === 'ArrowLeft'){
        showSlide((current - 1 + slides.length) % slides.length);
    }
});

window.addEventListener('resize', ()=> slides.forEach(autoFitText));
</script>
</body>
</html>
